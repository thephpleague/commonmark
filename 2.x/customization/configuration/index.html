




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="description" content="Defining configuration schemas and accessing user-provided configuration options within your custom extensions">
    
    <meta name="docsearch:version" content="2.x">
    
        <title>Configuration - CommonMark for PHP</title>
    
    <link rel="icon" type="image/x-icon" href="//theme.thephpleague.com/img/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="//theme.thephpleague.com/img/apple-touch-icon-precomposed.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@thephpleague" />
    <meta name="twitter:creator" content="@colinodell" />
    <meta property="og:url" content="https://commonmark.thephpleague.com/2.x/customization/configuration/" />
    
        <meta property="og:title" content="Configuration - CommonMark for PHP" />
    
    
        <meta property="og:description" content="Defining configuration schemas and accessing user-provided configuration options within your custom extensions" />
    
    <meta property="og:image" content="https://commonmark.thephpleague.com/images/commonmark-social.png" />
    <link rel="stylesheet" href="//theme.thephpleague.com/css/all.css?">
    <link rel="stylesheet" href="/custom.css?">
    <link rel="stylesheet" href="/global.css?">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <link rel="stylesheet" href="/support.css?">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137970568-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-137970568-1');
    </script>
</head>
<body>
<header>
    <div class="header-content">
        <h1 class="title">
            <a class="logo" href="/">
            <span class="name">
                <em>League\</em>CommonMark
            </span>
            </a>
        </h1>
        <div class="search"><input type="search" id="doc-search" placeholder="search the docs..."></div>
        <nav class="versions">
            <h2>v2.x &#9662;</h2>
            <ul>
            
                <li class="selected"><a href="/2.x/customization/configuration/">v2.x</a></li>
            
                <li ><a href="/1.x/">v1.x</a></li>
            
                <li ><a href="/releases/">Notes</a></li>
            </ul>
        </nav>
    </div>
</header>

<input type="checkbox" id="menu">
<label for="menu" onclick>
    <div class="closed">&#9776;</div>
    <div class="open">&#10799;</div>
</label>

<main>
    <menu>
        <div class="versions-small">
        <h2>Versions</h2>
            <ul>
        
                <li class="selected">
                    <a href="/2.x/">2.x</a>
                </li>
        
                <li >
                    <a href="/1.x/">1.x</a>
                </li>
        
                <li ><a href="/releases/">Releases Notes</a></li>
            </ul>
        </div>

        
            
            <div class="menu-section">
                <h2>Getting Started</h2>
                <ul>
                    
                        <li >
                            <a href="/2.x/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/installation/">Installation</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/upgrading/">Upgrading</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/changelog/">Changelog</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/support/">Support</a>
                        </li>
                    
                </ul>
            </div>
            
            <div class="menu-section">
                <h2>Usage</h2>
                <ul>
                    
                        <li >
                            <a href="/2.x/basic-usage/">Basic Usage</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/security/">Security</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/xml/">XML</a>
                        </li>
                    
                </ul>
            </div>
            
            <div class="menu-section">
                <h2>Extensions</h2>
                <ul>
                    
                        <li >
                            <a href="/2.x/extensions/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/commonmark/">CommonMark</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/github-flavored-markdown/">GitHub-Flavored Markdown</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/attributes/">Attributes</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/autolinks/">Autolinks</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/default-attributes/">Default Attributes</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/description-lists/">Description Lists</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/disallowed-raw-html/">Disallowed Raw HTML</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/embed/">Embed</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/external-links/">External Links</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/footnotes/">Footnotes</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/front-matter/">Front Matter</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/heading-permalinks/">Heading Permalinks</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/highlight/">Highlight</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/inlines-only/">Inlines Only</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/mentions/">Mentions</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/smart-punctuation/">Smart Punctuation</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/strikethrough/">Strikethrough</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/table-of-contents/">Table of Contents</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/tables/">Tables</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/extensions/task-lists/">Task Lists</a>
                        </li>
                    
                </ul>
            </div>
            
            <div class="menu-section">
                <h2>Customization</h2>
                <ul>
                    
                        <li >
                            <a href="/2.x/customization/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/environment/">Environment</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/extensions/">Extensions</a>
                        </li>
                    
                        <li class="selected">
                            <a href="/2.x/customization/configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/event-dispatcher/">Event Dispatcher</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/cursor/">Cursor</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/block-parsing/">Block Parsing</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/inline-parsing/">Inline Parsing</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/delimiter-processing/">Delimiter Processing</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/abstract-syntax-tree/">Abstract Syntax Tree</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/rendering/">Rendering</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/slug-normalizer/">Slug Normalizer</a>
                        </li>
                    
                        <li >
                            <a href="/2.x/customization/disabling-features/">Disabling Features</a>
                        </li>
                    
                </ul>
            </div>
            
        
    </menu>
    <article>
    

    

    

        <h1 id="configuration-schemas-and-values">Configuration Schemas and Values</h1>

<p>Version 2.0 introduced a new robust system for defining configuration schemas and accessing them within custom extensions.</p>

<h2 id="configuration-schemas">Configuration Schemas</h2>

<p>Unlike in 1.x, all configuration options must have a defined schema.  This defines which options are available, what types of values they accept, whether any are required, and any default values you wish to define if the user doesn’t provide any.</p>

<p>These custom options can be defined from within your <a href="/2.x/customization/extensions/">custom extension</a> by implementing the <code class="language-plaintext highlighter-rouge">ConfigurableExtensionInterface</code>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">League\Config\ConfigurationBuilderInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\CommonMark\Extension\ConfigurableExtensionInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Nette\Schema\Expect</span><span class="p">;</span>

<span class="k">final</span> <span class="kd">class</span> <span class="nc">MyCustomExtension</span> <span class="kd">implements</span> <span class="nc">ConfigurableExtensionInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">configureSchema</span><span class="p">(</span><span class="kt">ConfigurationBuilderInterface</span> <span class="nv">$builder</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="nf">addSchema</span><span class="p">(</span><span class="s1">'my_extension'</span><span class="p">,</span> <span class="nc">Expect</span><span class="o">::</span><span class="nf">structure</span><span class="p">([</span>
            <span class="s1">'enable_some_feature'</span> <span class="o">=&gt;</span> <span class="nc">Expect</span><span class="o">::</span><span class="nf">bool</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
            <span class="s1">'html_class'</span> <span class="o">=&gt;</span> <span class="nc">Expect</span><span class="o">::</span><span class="nf">string</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="s1">'my-custom-extension'</span><span class="p">),</span>
            <span class="s1">'align'</span> <span class="o">=&gt;</span> <span class="nc">Expect</span><span class="o">::</span><span class="nf">anyOf</span><span class="p">(</span><span class="s1">'left'</span><span class="p">,</span> <span class="s1">'center'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="s1">'left'</span><span class="p">),</span>
            <span class="s1">'favorite_number'</span> <span class="o">=&gt;</span> <span class="nc">Expect</span><span class="o">::</span><span class="nf">int</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span>
        <span class="p">]));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">register</span><span class="p">(</span><span class="kt">EnvironmentBuilderInterface</span> <span class="nv">$environment</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="c1">// TODO: Implement register() method</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>See the <a href="https://config.thephpleague.com/1.0/schemas/">league/config documentation</a> for more examples of how to define custom configuration schemas.</p>

<p>Note that you only need to implement <code class="language-plaintext highlighter-rouge">ConfigurableExtensionInterface</code> if you plan to define new configuration options - you don’t need this if you’re only reading existing options.</p>

<h2 id="reading-configuration-values">Reading Configuration Values</h2>

<p>Okay, so your extension has defined the different options that are available, but now you want to start using them within your custom extension.  There are a few ways you can access the values:</p>

<h3 id="during-extension-registration">During Extension Registration</h3>

<p>Perhaps your extension needs to decide whether/how to register certain parsers/renderers/etc based on the user-provided configuration values - in that case, you can read the value from the <code class="language-plaintext highlighter-rouge">$environment</code> - for example:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">League\Config\ConfigurationBuilderInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\CommonMark\Environment\EnvironmentBuilderInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\CommonMark\Extension\ConfigurableExtensionInterface</span><span class="p">;</span>

<span class="k">final</span> <span class="kd">class</span> <span class="nc">MyCustomExtension</span> <span class="kd">implements</span> <span class="nc">ConfigurableExtensionInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">configureSchema</span><span class="p">(</span><span class="kt">ConfigurationBuilderInterface</span> <span class="nv">$builder</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="c1">// (see code example above)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">register</span><span class="p">(</span><span class="kt">EnvironmentBuilderInterface</span> <span class="nv">$environment</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$environment</span><span class="o">-&gt;</span><span class="nf">getConfiguration</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'my_extension/enable_some_feature'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$environment</span><span class="o">-&gt;</span><span class="nf">addBlockStartParser</span><span class="p">(</span><span class="k">new</span> <span class="nc">MyCustomParser</span><span class="p">());</span>
            <span class="nv">$environment</span><span class="o">-&gt;</span><span class="nf">addRenderer</span><span class="p">(</span><span class="nc">MyCustomBlockType</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="k">new</span> <span class="nc">MyCustomRenderer</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="within-parsersrendererslisteners">Within Parsers/Renderers/Listeners</h3>

<p>Perhaps you want to reference those configuration values from within a custom parser, renderer, event listener, or something else.  This can easily by done by having that class also implement <code class="language-plaintext highlighter-rouge">ConfigurationAwareInterface</code>.  This interface signals to the <code class="language-plaintext highlighter-rouge">Environment</code> that your class needs a copy of the final configuration so it can read it later:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">League\CommonMark\Node\Node</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\CommonMark\Renderer\ChildNodeRendererInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\CommonMark\Renderer\NodeRendererInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\Config\ConfigurationAwareInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">League\Config\ConfigurationInterface</span><span class="p">;</span>

<span class="k">final</span> <span class="kd">class</span> <span class="nc">MyCustomRenderer</span> <span class="kd">implements</span> <span class="nc">NodeRendererInterface</span><span class="p">,</span> <span class="nc">ConfigurationAwareInterface</span>
<span class="p">{</span>
    <span class="cd">/**
     * @var ConfigurationInterface
     */</span>
    <span class="k">private</span> <span class="nv">$config</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">setConfiguration</span><span class="p">(</span><span class="kt">ConfigurationInterface</span> <span class="nv">$configuration</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="nv">$configuration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">render</span><span class="p">(</span><span class="kt">Node</span> <span class="nv">$node</span><span class="p">,</span> <span class="kt">ChildNodeRendererInterface</span> <span class="nv">$childRenderer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'My favorite number is '</span> <span class="mf">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'my_extension/favorite_number'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can access any configuration value from here, not just the ones you might have defined yourself.</p>


        <hr>

        <p>
            <a class="btn btn-sm btn-black" href="https://github.com/thephpleague/commonmark/edit/2.x/docs/2.x/customization/configuration.md" title="Edit this page on GitHub" target="_blank" rel="noopener"><i class="fas fa-edit"></i> Edit this page</a>
        </p>
    </article>

    <aside class="support-banner-wrapper" x-data="{ show: false }" x-show.transition="show" x-init="h = localStorage.getItem('hideBanner'); (h === null || h < (new Date().getTime())) ? (setTimeout(() => show = true, 500)) : (show = false)">
        <div class="support-banner">
            <p class="support-banner-left">
                <strong>Love PHP Commonmark?</strong>
                <span class="hidden sm:inline-block lg:hidden">
                    Show your support!
                </span>

                <span class="hidden lg:inline-block">
                    Support development via monthly sponsorship or a one-time donation!
                </span>
            </p>

            <div class="support-banner-right">
                <a href="https://github.com/sponsors/colinodell" class="btn btn-pink btn-block">
                    <i class="fas fa-heart fa-fw" aria-hidden="true"></i> Sponsor
                </a>

                <a href="https://www.paypal.me/colinpodell/10.00" class="btn btn-green btn-block">
                    <i class="fas fa-donate fa-fw" aria-hidden="true"></i> Donate
                </a>
            </div>

            <button x-on:click="localStorage.setItem('hideBanner', new Date().getTime() + (7*24*60*60*1000)); show = false" class="support-banner-close">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </aside>
</main>

<footer>
    <span>&copy; Copyright <a href="https://www.colinodell.com">Colin O'Dell</a> &amp; <a href="//thephpleague.com">The League of Extraordinary Packages</a>.</span>
    <span>Site design by <a href="//reinink.ca">Jonathan Reinink</a> and <a href="//nyamsprod.com">Ignace Nyamagana Butera</a>.</span>
</footer>
<script src="/custom.js?"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
<script> docsearch({
    apiKey: 'f8a60b0120292f75f23d313f6cebba05',
    appId: '5WPQI5503X',
    indexName: 'commonmark-thephpleague',
    inputSelector: '#doc-search',
    algoliaOptions: { 'facetFilters': ["version:v2.x"] },
    debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>
